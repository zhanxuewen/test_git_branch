<?php

namespace App\Console\Commands\ZXZJ\Word;

use App\Foundation\Excel;
use App\Foundation\PdoBuilder;
use Carbon\Carbon;
use Illuminate\Console\Command;

class ExportWordInfo extends Command
{

    use PdoBuilder;
    use Excel;
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'export:word_info {pdo=local}';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = '导出教研所需的数据';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }


    /**
     * Execute the console command.
     *
     * @return void
     */
    public function handle()
    {
        $words = [
//            'blame','brake','broke','chief','cure','equal','reserve','ruin','scale','suspect','switch','tense','toward','track'
//                'darkness'
            'contrast','contrast','deal','deal','deal','deal','kid','kid','kid','kid','late','late','ring','ring','ring','ring','equal','equal','toward','toward','blame','blame','cure','cure','reserve','reserve','reserve','tense','tense','ruin','ruin','suspect','suspect','scale','scale','scale','scale','switch','switch','brake','brake','track','track','broke','broke','chief','chief'
        ];

        $words = array_unique($words);

        dd($words);

        config(['database.default' => 'zxzj_online_search']);

        $sql = <<<EOF
SELECT * FROM `word`.`wordbank_2` WHERE `id` IN (133,134,183,183,184,184,418,418,419,419,427,428,429,500,500,501,501,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631)
EOF;

        $res = \DB::select(\DB::raw($sql));

//        $res = \DB::table('wordbank')
//            ->selectRaw('vocabulary,wordbank_translation.id as translation_id, part_of_speech, translation')
//            ->leftJoin('wordbank_translation', 'wordbank_translation.wordbank_id', '=', 'wordbank.id')
//            ->whereIn('vocabulary', $words)
//            ->whereNull('wordbank.deleted_at')
//            ->whereNull('wordbank_translation.deleted_at')
//            ->get();

        $export_data = [];
        $export_data[] = [
            '单词','词性','解释','标签id','标签链'
        ];

        $header = ['Authorization:'.''];
        $url = 'https://manage.wxzxzj.com/api/word/get/labelList';
        foreach ($res as $item){
            $vocabulary = $item->vocabulary;
            $part_of_speech = $item->part_of_speech;
            $translation = $item->translation;
            $translation_id = $item->translation_id;

            $data = [
                'translation_id'=>$translation_id,
                'scope'=>'wordbook'
            ];

            $json_res = $this->request($url,true,'post',$data, $header);
            $label_list = json_decode($json_res, true )['data']['label_list'];
            foreach ($label_list as $label_item){
                $export_data[] = [
                    $vocabulary,$part_of_speech,$translation,$label_item['label_id'],$label_item['label_link']
                ];
            }
            echo '+';
        }
        $this->store('漏单词'.rand(0,100), $export_data, '.xlsx');


        dd('done');


        $word_300 = [
            2834,2843,6890,6341,1923,6985,3352,6409,6412,2452,1931,2868,2461,2470,2876,1470,6283,1478,3845,6406,1954,1954,1954,6391,3849,4969,6955,3379,6889,3807,3856,3856,6397,6397,6951,2897,6962,6758,2503,2503,3840,3840,6983,1524,1530,5436,6898,6361,4722,3839,4758,5661,6977,2906,2005,6344,2521,6364,6365,6375,4903,5395,6960,1560,1560,6372,2534,1565,6966,2914,2035,2035,5084,2542,6168,6399,1582,2549,2551,6354,6280,2922,6775,2065,2065,2067,7512,6379,6382,6897,3182,2929,5966,960,2573,1623,2933,4570,2578,5190,9308,6416,6408,976,6989,6899,6899,6899,6343,261,5524,2115,2944,6888,6888,4748,6392,6348,6414,6390,1652,6353,2602,5318,2955,2955,6751,2956,6903,6385,6958,3828,2150,6377,2152,2152,6979,6893,6891,6395,6982,2160,1686,3820,6369,6904,6405,6402,2621,6782,6349,1031,6967,6360,1693,2627,6374,2173,3837,6468,3881,2633,6380,8749,6666,3803,1698,6376,6366,6366,6991,6990,6350,3859,2976,6974,3848,2184,6469,3810,6358,2206,2983,6121,2653,8684,6411,2664,6386,6954,6351,2996,6381,2671,2671,6978,6978,6387,2672,3001,1741,6984,6087,4396,4426,2244,6396,2255,6403,4394,6371,1755,1755,2260,1756,6357,1126,1126,6363,2271,3814,3814,6986,6346,2684,6400,3025,1146,3879,6952,6384,1795,6417,3825,3825,6895,6969,4176,6905,2307,1172,6373,3858,1815,3847,6359,2711,2711,1188,1821,3823,2720,5423,2334,6401,6887,3249,6367,6367,6367,3056,6896,3826,3875,3875,4992,2343,2345,6404,2346,3257,6912,3824,3824,6356,2741,6964,6963,6362,4175,3872,3487,3487,2763,3272,3880,9553,6980,6902,6972,5600,6987,6368,3083,7421,3844,3291,6971,2787,3906,2788,6970,3805,2798,1328,6965,3817,6900,1343,6355,6901,1355,2813,9501,6410,3112,6968,1896,6398,3518,6347,3860,6894,6892,3585,3585,6961,1387,1387,2824,3124,6370,6383
        ];
        $word_mess = [
            820,832,23,23,27,1447,1447,38,38,39,39,39,2878,2878,857,858,858,861,865,865,866,1471,1471,1481,4933,67,69,69,1484,70,70,1487,77,77,892,896,896,4144,4144,82,82,86,86,92,901,901,93,93,6001,98,1510,1510,2501,109,109,1982,1982,1516,1517,1529,1529,1989,1989,120,920,920,124,124,128,1534,1534,129,129,132,134,133,1996,1996,1999,6621,6621,2002,1538,1538,929,929,2008,2008,1544,1544,3946,1546,137,137,139,139,139,140,140,1547,1547,143,144,148,1553,152,152,152,936,936,154,156,156,939,939,940,4039,160,160,161,165,165,943,943,166,166,169,1578,1578,2046,1585,1585,1590,1590,1596,3793,6913,6913,187,1601,188,188,949,949,1603,191,191,3770,1604,193,193,194,194,195,196,196,196,197,197,203,205,205,4048,4048,3991,209,209,209,210,3552,3552,212,212,213,213,214,217,957,957,964,229,229,1629,232,232,235,1634,1634,1634,236,236,236,968,238,238,240,240,970,969,245,247,249,2106,2106,1641,1641,254,3654,256,256,257,257,1643,259,259,982,982,263,263,263,984,984,2112,265,265,268,268,1646,1646,990,990,990,272,272,272,1648,1648,274,274,1650,1650,277,277,283,283,1654,1654,286,286,286,2127,2127,292,292,998,998,294,2606,2606,295,295,1661,1661,306,306,307,307,1003,1003,309,3607,3607,319,319,322,322,1017,1017,326,326,326,331,331,346,346,2153,2153,1681,1681,358,2162,2162,366,366,2629,2629,6467,6467,1034,2176,2176,1697,1697,377,377,378,378,1046,1046,381,381,382,393,393,395,395,396,396,399,399,4186,4186,402,402,403,403,403,4158,4158,4158,2189,409,409,409,411,411,411,412,412,412,413,413,413,414,414,2193,2193,416,3581,424,424,1056,425,425,2200,1061,1061,434,2220,2220,1731,1731,1098,490,500,500,3571,514,523,1765,2285,1161,565,565,565,566,568,568,576,1184,1184,1820,1198,1198,586,586,586,587,587,1199,1199,592,592,1200,1200,596,596,596,596,597,597,599,599,6577,6577,601,601,604,607,607,3577,3577,612,612,1218,1221,1221,2738,2738,617,617,1226,1226,1227,1227,1842,1842,624,624,629,629,632,632,4262,4262,6296,1848,1848,2756,2756,2756,645,645,1849,1849,1260,1260,1261,1261,2766,2766,1263,1263,1271,1271,667,1273,1273,1278,1278,1857,1857,671,671,674,674,1282,1282,1286,1286,734,734,1335,1335,768,768,782,782
        ];
        $word_single = [
            18,1411,2,812,3,4,813,2427,1912,814,1412,4284,1913,3132,1915,2434,2435,4324,815,5,816,1413,4096,1414,817,818,4103,2837,819,3930,2438,1415,1919,1920,2845,8,4160,821,822,2441,3976,1417,1418,823,1921,1922,9,10,6917,11,826,12,2442,2443,13,827,1419,2848,828,1420,1422,14,6570,1924,1424,1425,1925,2849,3883,830,15,1426,831,16,834,3344,835,6453,17,1427,2444,836,18,4168,2853,4179,2854,2855,837,3643,838,1429,2446,3664,2859,1926,21,1430,6139,839,840,2447,4228,6192,22,841,1431,4177,24,4249,25,26,3903,843,1432,1433,6393,1434,1435,1436,1437,4331,3355,6413,28,2455,3545,3982,3723,3358,29,844,1439,30,1440,845,31,846,32,3533,1442,847,6836,9126,33,1443,849,850,851,34,852,4226,1934,2871,35,3615,853,2873,2469,1444,1938,3952,1939,1940,1941,1942,1943,1944,3547,36,6044,3898,3703,6817,854,3146,1945,7018,1446,1448,37,3363,6791,4346,4131,6909,1449,4304,1450,2875,40,3784,2471,41,1452,4166,2472,4340,1453,4330,42,1454,1455,2877,43,855,44,4300,4159,856,2473,2475,4339,1459,45,859,860,863,3366,1949,1950,1461,47,1462,864,8508,6058,1463,867,867,3613,1465,6302,3658,868,48,49,869,3747,3774,870,871,872,50,7097,51,1466,2880,2481,1951,1952,52,4311,875,53,1467,54,1468,1469,55,56,3560,6875,3696,876,1474,59,57,3587,6797,58,877,878,3812,3367,6925,2483,60,6064,61,62,1953,1475,63,1476,1477,64,879,1479,1480,2884,6314,4156,5408,1482,4102,6607,4239,1483,880,65,66,4357,6079,881,6451,68,882,883,6082,6455,3705,3691,4105,884,6795,1485,71,885,72,73,3622,2887,2889,1488,886,74,1489,75,6844,887,6939,1490,1491,888,7022,4173,6324,76,78,889,890,1493,891,1961,3900,79,893,3709,1496,8512,80,894,81,3652,895,4209,4130,6016,6565,7088,83,6563,4199,3589,3624,3152,4042,6456,2490,897,4307,84,1499,85,1500,87,1963,2491,1501,6565,89,90,1965,6059,4198,6040,1502,899,91,4328,2492,3740,6049,7003,900,3619,1966,1967,6154,6458,3796,3827,2494,1503,94,898,6886,6812,2894,6870,95,902,1968,4806,96,97,6614,3979,99,3574,1504,4318,6440,1970,3623,1505,6061,100,6865,1506,6804,1972,1507,3644,1508,2496,101,102,5986,2896,3958,1511,1512,1974,6847,1975,6045,6449,905,105,906,907,908,104,909,5614,2499,106,107,2898,108,1513,910,2502,1978,911,1514,3385,1981,3994,2900,7010,1515,110,6794,6829,111,6567,912,1518,1520,3741,4076,2504,1983,3959,5992,1522,6837,1523,913,112,113,914,4033,7013,915,6876,4369,916,917,6459,918,1526,3386,114,3939,1985,4246,3908,1986,8509,1987,115,2508,116,2903,2509,117,1990,118,119,2512,4063,919,6828,1531,121,1532,1533,122,4245,4047,1992,123,6460,125,126,127,921,3786,922,923,1535,1536,6619,6558,131,924,925,3667,3645,1995,926,1537,927,3887,7093,6345,135,1998,2000,6830,2514,2515,3800,928,2003,3393,2004,2516,2517,4217,3876,3993,2006,3716,2518,4138,136,3165,930,2009,2010,2011,2012,2013,2520,3829,2014,6838,6839,2016,2017,6024,1540,2018,1541,2021,4223,4375,1543,2023,4041,6845,6923,2908,1545,2527,2529,2530,6935,7002,931,138,6067,3822,4206,141,142,6022,6592,3954,3945,4117,932,145,4363,146,147,933,934,1549,1550,1551,935,149,6053,6590,3575,3578,4349,3414,1554,150,2027,6626,4317,2028,2029,6906,1556,2030,4020,4286,6028,151,153,1557,3888,4338,7015,3878,3576,4216,6550,4196,6027,6329,1558,155,1559,8511,4238,3927,2536,3418,937,938,3599,3808,2031,157,1562,159,3631,941,1564,6075,6129,162,163,164,6319,2034,167,3551,168,2037,2539,2540,2541,1568,1569,4378,2041,2042,1571,2543,2916,1576,2043,2544,1579,170,4154,2045,2546,2047,4211,2547,1580,1581,1583,171,172,5766,2048,173,6815,1584,3608,174,1586,175,4241,1587,1588,946,2920,7096,1589,4376,176,3172,3425,1591,4367,1592,4134,177,2550,2051,1593,1594,1595,2052,2053,4306,3951,3897,2553,1597,1598,2054,1599,178,947,6840,3853,4364,2055,2057,2058,948,2060,4174,8812,181,182,1600,3997,6427,183,6031,184,185,4093,3718,6859,186,4145,6916,2064,6571,4207,4079,4189,1602,6554,950,3904,8281,4007,3616,192,6793,3957,3638,2068,4051,6576,6014,4026,2070,6636,2071,6424,198,3553,6588,1605,953,6068,7024,199,3855,2923,200,4027,5802,6872,3178,201,2924,202,1608,4289,7030,204,6389,1609,3557,1611,955,206,207,3636,4025,4315,2073,2075,2558,2559,3995,2560,1612,5139,4534,2076,6994,208,3429,6065,4139,4157,3670,3685,6850,3891,3755,3938,3835,2077,2561,2563,2564,2078,6934,3679,3777,211,4308,4308,2079,3974,2080,6835,4213,215,956,2082,2082,1614,3697,3529,216,1615,2567,1616,958,959,2568,2569,4281,4263,2571,961,6642,1617,2085,2086,2087,3185,3909,218,219,1618,2932,220,221,222,223,224,225,226,1619,1620,227,228,962,963,4015,1621,1622,965,3588,4261,3789,230,2575,966,967,1625,1626,2088,1627,1628,2579,3865,1630,1631,2089,231,7029,1632,4344,2090,233,234,2091,4377,7006,3739,4247,3570,4218,4251,1636,4301,2092,237,2093,2936,239,2094,6446,241,3886,6883,4276,1637,6843,242,4068,6423,243,244,2096,971,1640,2098,4172,3544,972,973,246,4097,3620,2099,4075,2100,2101,2938,2102,974,6816,975,2104,2105,248,2939,5935,3683,6300,3690,3689,6948,2107,250,6425,251,4314,3563,252,6335,253,3931,977,2940,255,3566,3955,3811,3910,3971,2585,6557,1642,3597,3671,258,4069,979,2109,4151,2110,6046,4221,3656,3596,980,981,260,2942,262,6066,983,6448,6573,985,1644,2113,986,2589,987,264,1645,266,267,6048,6574,6833,4001,2591,3632,6151,2591,269,270,6010,989,3936,4003,3433,1647,4322,271,6947,4106,4141,2946,3677,3748,6587,3779,273,3722,6907,2593,2594,3708,3732,3538,993,3928,275,276,6596,1651,3916,2118,278,5626,279,6056,2119,2120,9050,280,281,2121,3437,995,2122,2597,3868,996,3725,2949,282,7092,2598,2599,4136,3193,284,285,3580,1653,6863,3634,6591,6941,2601,6813,1655,1656,4129,2123,6832,3710,3721,2603,3914,3568,287,8133,3195,288,6310,289,290,291,3719,2126,6593,997,6776,2128,293,4269,3592,999,3813,1000,6818,3673,3769,6569,1658,1659,3650,1660,4030,3969,1662,2129,2130,1663,1664,296,3626,297,301,6825,299,6824,3602,303,304,2131,6854,4080,305,6548,6429,2953,6317,1004,6436,3956,3926,7019,1001,1002,6564,2134,308,4132,310,6823,1667,311,1005,1006,6463,1007,312,3980,4302,1668,1008,313,6796,314,6321,315,3912,4236,2137,2610,6017,316,1009,6445,2140,1010,8510,317,6011,4291,3782,1670,318,2613,2614,7091,320,4191,6033,1672,1673,1011,3594,321,1012,4271,1674,323,324,1013,1675,1676,4366,4323,1014,3934,1677,325,6012,1015,1016,2146,4059,3901,2147,2148,2149,327,3440,328,7001,6159,1018,3733,329,330,332,2616,333,334,3771,335,1678,2959,336,3989,6420,337,4128,338,339,6931,4094,340,4293,4282,341,342,4310,1020,6301,343,4352,344,345,6578,3199,3836,6922,6857,3730,1021,347,347,4162,2151,4111,6050,6810,6584,348,1023,6821,2154,349,350,351,352,353,354,6318,1024,6866,355,356,2155,357,4342,1684,4867,2159,2156,3699,1025,1685,6874,5997,1026,1027,3666,3871,3201,360,1028,4074,4252,361,6338,4197,2161,362,363,1029,6659,1687,5658,4371,3968,3833,1688,1030,1689,2622,2164,364,2165,1690,3745,2168,2623,2624,4783,3714,3746,6937,3818,6466,2169,4277,2170,1691,3933,6918,1692,365,2966,4009,1033,3204,3206,2968,4297,2630,3651,1035,2632,367,4374,3208,2174,3625,368,1694,1695,1036,1696,3864,2175,1037,4358,3665,1038,369,3863,3742,4100,3966,370,371,4237,1039,6908,3543,3797,3711,2177,4126,1040,2179,372,6995,4148,1041,6036,4013,3911,373,2636,374,1042,2637,1043,1044,6878,1045,3546,375,6007,4050,3542,2971,1699,6827,376,2973,4260,2180,6439,1700,379,380,1047,1048,1049,3948,2975,1702,1703,6822,383,1704,384,4046,4149,1050,385,386,3963,387,1705,6862,3787,6096,3962,6933,6861,388,1706,389,2640,1707,390,391,3775,392,2182,1708,6942,7020,1709,1710,2183,4155,394,4319,2643,3554,3724,397,4073,2644,5343,398,3821,2645,1712,1713,1714,2646,400,2647,4188,3983,3867,401,3628,2185,7005,1715,404,6754,6676,2978,3211,405,2187,406,407,408,6084,1716,2979,2188,1051,4072,2190,410,6777,4224,4268,4232,3984,4353,3932,6442,1717,2191,2192,415,7000,3735,3212,2651,2195,3443,417,418,1053,6437,2196,2197,3802,3862,1054,4137,3791,1055,419,6855,4057,6800,420,2980,421,6868,1720,422,6950,423,3649,6326,6325,4061,4146,426,4122,1057,3905,427,6681,1058,6856,4295,1059,1060,428,3618,2199,4971,5995,5254,1062,3915,1721,430,4264,6884,6885,2204,4279,6806,431,2205,1722,4078,1723,3830,432,3715,433,3445,3215,2208,1063,6852,1064,2209,3815,1065,3877,4171,2982,2211,4008,1066,4113,2212,6305,2215,3528,3541,435,1067,436,437,1068,1069,3834,6308,1070,2216,438,8132,2217,2654,1071,2655,439,440,4127,1072,2656,2657,2658,3768,2659,2218,1725,2660,1074,6434,2988,1075,2989,4029,1726,442,1727,441,3773,4183,6441,6018,6234,1076,1728,4294,443,4354,2990,1077,444,7582,4355,3799,6432,1078,445,2991,2665,2993,2666,1079,1729,3611,446,6009,2995,4227,3998,6869,1080,4373,2222,2224,1732,2668,7016,8505,1081,3534,1084,3965,1733,4010,1085,3565,451,2669,3918,452,3567,4257,6304,2997,3558,453,4034,3899,3846,6438,454,1734,4000,4095,2226,2998,3920,1086,2228,455,456,1087,4004,3678,457,3610,459,3688,461,462,2229,4070,1736,3450,6062,463,3532,2231,2232,464,7098,2233,465,466,3999,3992,3000,467,6340,3937,4011,2234,1737,2235,2236,2237,1738,3598,468,1088,1089,3943,1090,469,3003,470,6407,1740,2240,1739,2239,471,3005,2241,6328,3006,472,472,473,474,6921,475,1091,476,477,6330,2242,478,4182,3672,3751,6851,3756,3892,479,481,1092,1093,3935,1742,482,6051,1094,3591,483,484,1743,4275,485,1095,3804,1096,1097,3843,486,4243,487,1099,488,1744,7009,1100,3550,489,1745,3007,491,492,1101,1746,1102,4214,3953,3219,1747,493,3549,494,495,1103,496,1748,1749,497,1104,7090,499,4055,4365,2249,4099,501,502,503,504,3221,6063,505,506,507,1750,2250,1751,2251,2251,4108,2253,508,1753,509,7048,1105,1754,2256,2254,4119,510,6860,511,512,1107,513,3806,1108,3013,1110,3453,6316,515,1113,2258,4267,4305,4081,516,1114,2262,2262,3792,3225,3014,2263,4187,2265,6100,517,518,1116,1117,6378,4028,1118,1119,3572,519,4266,2266,1120,1121,2267,520,4037,521,7026,3819,6826,1757,1758,1122,6426,6113,522,1123,3018,2682,1125,524,525,1759,1760,2270,3778,526,7025,4215,1127,1761,3228,3019,527,3531,530,1128,1763,4368,2272,6932,4335,531,4677,6223,4347,6315,4233,532,533,533,6853,6583,6807,4370,534,3456,1130,1764,1766,1767,1768,1131,1769,3457,2274,535,2275,3022,536,2277,3973,537,539,540,1772,3986,6475,2278,2279,1773,1774,541,541,541,1132,543,3023,544,4288,545,6589,1133,1134,3024,2281,3026,3458,1135,3027,2282,2283,6556,6025,4098,546,3695,547,547,2685,548,549,2284,4336,3659,550,6999,6926,8338,5447,551,2686,552,552,6004,3702,1136,4049,8271,4006,1137,553,1138,1139,1140,2286,6551,1141,1142,1142,3586,1143,1144,4005,1145,1145,2687,1147,1148,6946,1149,7087,3029,3232,1150,3831,2690,1775,1776,1777,1778,6054,1151,556,557,557,3233,558,6339,1779,3970,559,1780,2290,2691,2693,6842,2291,1153,4012,560,560,1154,3030,1155,2294,1156,6060,561,1781,6700,1782,1783,2295,1157,1158,1784,7011,1785,2695,5353,1159,2297,2298,1160,2697,3734,2699,1162,1162,1786,1787,1788,1789,3032,562,1163,2700,4299,3772,6561,4018,1164,3981,2701,2702,1790,1791,563,1792,1165,1793,1794,4287,1796,1797,6336,1798,2300,1799,2705,2706,2301,3873,1800,1801,4326,1166,1167,1802,2302,1168,1803,6568,6834,564,6015,3907,3466,1804,1169,7060,4121,3035,1806,1170,6013,1807,6555,4356,3036,3555,4082,1808,1809,1810,567,1171,569,3783,570,3780,571,3037,2308,2308,6303,1173,6235,3467,572,3038,3039,1175,573,1813,1814,7021,4180,4250,6444,1176,1177,4021,5673,1178,3882,1179,574,3040,575,1816,4372,1182,577,1183,2312,5685,2311,1185,1185,4017,1186,1817,1818,3816,3042,2315,2712,1187,1819,4234,3471,3850,578,6940,1189,6920,2714,3925,2715,1190,1191,4222,1822,2717,3944,3043,3978,2319,2320,2321,5999,4332,2322,3917,3919,3474,3244,3245,1193,5115,3987,579,2324,1823,5641,2325,580,1824,4219,2326,1194,1195,1196,3047,6805,3246,2327,2328,2330,2331,3977,4193,6311,4229,3851,1825,2332,2333,4320,581,1197,4274,1826,582,6949,4185,3582,1827,4152,3051,583,584,3053,585,3923,3809,4120,4014,2337,588,588,6820,589,6020,3054,6041,2339,590,2340,3637,591,3832,6034,6032,593,594,3479,595,4235,1201,3922,4321,2721,4220,3055,2722,1202,1203,1829,3251,598,600,6422,3713,3712,6170,602,3781,1204,603,3785,1830,3660,1205,3728,1206,4285,2341,1207,6801,6716,605,1834,4164,606,6880,6549,6766,2724,3612,7105,6560,2725,2726,2727,3539,2342,3254,608,1208,1835,4022,2729,3913,1209,3058,609,1210,6313,4184,1213,3530,2730,1836,3059,4283,1215,6119,6914,2347,1214,4359,610,3562,3258,1837,1216,1217,4881,611,3259,3737,4248,2731,2732,2734,613,2735,4133,3060,1219,8513,1220,2737,615,4202,616,1838,3635,2350,4212,3548,1839,6831,2740,1222,1223,3668,3750,6849,3890,3754,1224,2742,2743,618,2744,1841,1228,2353,2354,2746,619,620,1229,6421,2748,6042,1230,621,621,622,6594,1231,4253,623,5994,1232,625,626,5979,4056,6799,3064,1234,627,2749,628,2750,630,1235,6327,4280,631,2356,1237,633,3731,1238,1844,2751,3264,3265,1845,1846,634,6559,2359,2360,1847,4885,1239,635,2752,636,4035,4240,2753,6572,637,638,639,6307,4200,2754,3676,3749,3889,3753,640,641,2755,6295,3595,4210,7017,1240,1241,1242,3267,642,6595,643,3066,6779,644,3921,4052,1243,3068,4067,3069,2363,4589,2757,2758,6881,4170,4230,3686,646,4060,6798,4062,1244,647,6953,648,1245,6562,2759,1850,6808,1246,6021,3486,6882,6447,6037,6038,649,4109,4040,6721,1247,650,1248,1249,2760,2761,2762,5993,4341,651,1250,4348,1851,652,2364,653,4225,1852,654,655,3657,1251,656,657,657,1252,1253,658,659,660,4242,6323,1853,661,1254,662,2366,2764,6203,663,1255,3861,1256,1257,3842,4259,4327,1258,3866,6433,1259,6388,6943,4309,4038,4053,664,4190,1262,665,1264,1265,3655,6998,4272,6052,3273,1854,4204,3073,3662,2369,666,6787,6873,6337,3949,2370,6334,1855,1267,4142,1856,1856,1856,3493,2371,2768,1269,1270,3647,7012,2372,6910,668,668,1272,6039,669,7095,3279,2373,1274,3077,670,4064,3282,2374,1275,1276,6846,1277,4143,3988,4255,6992,4195,6819,1279,2769,6322,672,673,6945,1280,6443,675,3559,2377,2378,1858,3720,2771,3285,2772,676,2375,1859,4343,1281,2773,5839,6778,677,3584,3902,7023,678,3633,6476,2379,679,1860,1283,1284,3694,1861,1862,1863,3942,680,1864,3687,2380,1285,1865,1866,2382,2383,6148,2384,681,682,4244,3540,6431,3729,1287,1288,4124,4125,1289,3082,4296,4201,1867,6055,6814,683,1868,1290,1869,684,4165,4104,2775,4114,4115,4112,1870,3692,2385,3854,2387,2388,3929,6299,3556,685,1292,686,6877,687,6043,3593,3579,3294,4333,3790,2777,2778,3506,4110,2779,688,3507,3653,1293,2780,3794,689,4313,2389,2781,4002,690,6006,7094,691,3569,6802,1294,1294,692,1295,1296,1296,1297,3629,693,694,695,696,6435,4361,697,4116,1299,2394,698,698,2395,8173,4290,4298,2396,6002,6731,3985,538,2785,740,699,6035,2397,2786,3675,700,1300,3893,701,1873,4254,702,703,1301,6306,6099,704,705,4019,3606,3906,706,707,1303,1302,708,709,710,2400,711,1304,2789,712,1874,4107,713,714,715,1305,716,717,718,3972,1306,4058,3648,3621,3682,6848,4045,3681,6418,6419,719,720,1307,1308,3700,2401,3674,6331,2793,721,1876,1309,6430,6733,7004,3085,3086,3537,5996,3961,2794,722,723,1311,3639,1312,4140,724,725,1313,2402,1314,1315,1315,1316,726,3857,4360,1317,727,3088,728,6026,3941,1318,1319,6115,3642,1320,6057,2796,729,1321,2797,730,731,3617,1322,1323,2404,3564,3301,1324,1324,1325,4169,3302,1877,6936,1326,1327,2405,2406,6333,1329,2407,1330,732,3885,733,1878,6930,1879,2409,1331,3996,6019,1332,2800,2803,4316,6867,6003,1333,1334,3795,2805,1880,2410,735,6332,3511,2411,6566,1336,1337,1338,736,1339,5848,2413,1340,4163,1341,4265,737,1342,2414,3535,6023,3093,4031,3094,4181,738,738,4071,6580,6394,739,3894,3680,3895,3684,4091,6297,4043,4088,4087,4092,4084,4090,4089,4044,4086,4085,1344,741,6792,3669,1345,1345,3309,3097,1882,3798,1883,1347,2807,742,3099,4278,743,1348,1885,1349,6320,3310,4292,4303,1886,4016,3975,6915,3573,6352,2809,2810,3311,1350,2811,3103,3102,1889,3869,1351,744,6309,6924,3874,6081,745,1352,746,747,2812,4351,1354,748,4032,749,1357,1358,1359,1360,3693,2814,3106,2416,1892,6737,6047,4194,4753,2815,2816,1361,1362,6879,3107,4203,751,3109,6415,2817,2818,1363,1364,1365,6552,3313,4192,3114,3115,1366,1894,3315,3116,752,6005,6858,1368,4325,3119,1369,1895,4439,2417,1897,2819,753,1371,1898,1373,754,3990,755,2420,3717,756,1374,6030,757,2418,6553,1899,1900,3601,758,4065,2419,7014,1375,759,4066,8134,760,3967,3320,1376,761,762,763,1901,1902,4334,764,1378,765,1379,1903,3536,766,1380,1381,1382,1383,1384,767,3583,3614,3603,769,1904,3743,770,3120,771,771,1385,2422,2423,772,1386,773,1388,774,775,2820,776,6811,777,4270,1390,778,779,780,4350,1391,3870,781,2823,1906,783,1392,7008,3122,7007,784,6575,1393,1394,2825,1395,1396,1397,2424,1398,3852,785,786,788,6809,4077,1399,5998,789,3641,6008,1400,1401,790,4345,1402,6000,1403,6175,791,3640,792,3884,1404,793,3704,6944,1405,6158,794,1908,3125,795,796,6124,4337,1406,797,2827,6871,3707,6841,2828,798,3561,799,3630,3126,4083,1407,3776,800,6864,801,802,1408,803,4329,804,805,4054,806,807,808,809,1409,3698,3801,6996,6997,4036,3523,3328,810,3524,3525,811
        ];


        $label_ids = [
            144,145,146,147,148,149,3501,3505,3506,1228,1230,3507,3508,3511,3543,3677,3708,3709,3744,3825,3827,3860,3861,5802,5803,5804,5805,5806,5807,5809,5836,5844,5849,5855,5886,5891,6595,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,1249,1250,1251,1252,1253,1254,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1286,1287,1288,1289,1290,1291,1292,1293,1294,1295,1296,1297,1298,1299,1300,1301,1302,1303,1304,1305,1306,1307,1308,1309,1310,1311,1312,1313,1314,1315,1316,1317,1318,1319,1320,1321,1322,1323,1324,1325,1326,1327,1328,1329,1330,1331,1332,1333,1334,1335,1336,1337,1338,1339,1340,1341,1342,1343,1344,1345,1346,1347,1348,1349,1351,1352,1353,1354,1355,1356,1357,1358,1359,1360,1361,1362,1363,1364,1365,1366,1367,1368,1369,1370,1371,1372,1373,1374,1375,1376,1377,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1389,1390,1391,1392,1393,1394,1395,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,1425,1426,1427,1428,1429,1430,1431,1432,1433,1434,1435,1436,1437,1438,1439,1440,3509,3510,3512,3513,3514,3515,3516,3517,3518,3520,3521,3522,3523,3524,3525,3526,3527,3528,3529,3530,3531,3532,3533,3534,3535,3536,3537,3538,3539,3540,3541,3542,3544,3545,3546,3547,3548,3549,3550,3551,3552,3553,3554,3555,3556,3557,3558,3559,3560,3561,3562,3563,3564,3565,3566,3567,3568,3569,3570,3571,3572,3573,3678,3679,3680,3681,3682,3683,3684,3685,3686,3687,3688,3689,3690,3691,3692,3693,3694,3695,3696,3697,3698,3699,3700,3701,3702,3703,3704,3705,3706,3707,3710,3711,3712,3713,3714,3715,3716,3717,3718,3719,3720,3721,3722,3723,3724,3725,3726,3727,3728,3729,3730,3731,3732,3733,3734,3735,3736,3737,3738,3739,3740,3741,3742,3743,3745,3746,3747,3748,3749,3750,3751,3752,3753,3754,3755,3756,3757,3758,3759,3760,3761,3762,3763,3764,3765,3766,3767,3769,3770,3771,3772,3773,3775,3776,3777,3778,3779,3780,3781,3782,3783,3784,3785,3786,3787,3788,3789,3790,3791,3792,3793,3794,3795,3796,3797,3798,3799,3800,3801,3802,3803,3804,3805,3806,3807,3808,3809,3810,3811,3812,3813,3814,3815,3816,3817,3818,3819,3820,3821,3822,3823,3824,3826,3828,3829,3830,3831,3832,3833,3834,3835,3836,3837,3838,3839,3840,3841,3842,3843,3844,3845,3846,3847,3848,3849,3850,3851,3852,3853,3854,3855,3856,3857,3858,3859,3862,3863,3864,3865,3866,3867,3868,3869,3870,3871,3872,3873,3874,3875,3876,3877,3878,3879,3880,3881,3882,3883,3884,3885,3886,3887,3888,3889,3890,3891,3892,3893,3894,3895,3896,3897,3898,3899,3900,3901,3902,3903,3904,3905,3906,3907,3908,3909,3910,3911,3912,3913,3914,3915,3916,3917,3918,3919,3920,3921,3922,3923,3924,3925,3926,3927,3928,3929,3930,3931,3932,3933,3934,3935,3936,3937,3938,3939,3940,3941,3942,3943,3944,3945,3946,3947,3948,3949,3950,3951,3952,3953,3954,3955,3956,3957,3958,3959,3960,3961,3962,3963,3964,3965,3966,3967,3968,3969,3970,3971,3972,3973,3974,3975,3976,3977,3978,3979,3980,3981,3982,3983,3984,3985,3986,3987,3988,3989,3990,3991,3992,3993,3994,3995,3996,3997,3998,3999,4000,4001,4002,4003,4004,4005,4006,4007,4008,4009,4010,4011,4012,4013,4014,4015,4016,4017,4018,4019,4020,4021,4022,4023,4024,4025,4026,4027,4028,4029,4030,4031,4032,4033,4034,4035,4036,4037,4070,4071,4072,4073,4074,4075,4076,4077,4078,4079,4080,4081,4082,4083,4084,4085,4113,4116,4118,4121,4123,4128,4130,4133,4135,4136,4137,4139,4141,4144,4948,4954,4957,4960,4963,4965,4969,4974,4976,4978,4981,4983,4987,4988,4990,5037,5075,5078,5081,5083,5091,5094,5096,5099,5100,5103,5105,5108,5110,5112,5898,5905,5910,5913,5916,5920,5924,5928,5932,5935,5937,5941,5944,5948,5951,5956,5958,5961,5963,5964,5966,5968,5970,5972,5975,5977,5979,5980,5981,5982,5992,5994,5995,5998,6000,6001,6002,6003,6004,6005,6006,6008,6009,6010,6011,6027,6029,6031,6032,6034,6035,6036,6037,6038,6039,6040,6041,6042,6043,6044,6133,6134,6765,6766,6767,6768,6769,6770,200,249,250,2025,9473,1906,2122,2124,2125,8031,8032,8033,8395,8396,8850,9323,9324,9325,9474,9475,9476,9577,9578,9579,1907,2123,2126,2127,8397,8398,8399,8400,8401,8402,8403,8404,8405,8406,8407,8408,8409,8410,8411,8412,8413,8414,8415,8416,8417,8418,8419,8420,8421,8422,8423,8424,8425,8426,8427,8428,8429,8430,8431,8432,8433,8434,8435,8436,8437,8438,8439,8440,8441,8442,8443,8444,8445,8446,8447,8448,8449,8450,8451,8452,8453,8454,8455,8456,8457,8458,8459,8460,8461,8462,8463,8464,8465,8474,8475,8476,8477,8478,8479,9477,9478,9479,9480,9481,9482,9483,9484,9485,9486,9487,9488,9489,9490,9491,9492,9493,9494,9495,9496,9497,9498,9499,9500,9501,9502,9503,9504,9505,9506,9507,9508,9509,9510,9512,9513,9514,9515,9516,9517,9518,9519,9520,9521,9522,9523,9524,9525,9568,2128,2129,2130,2131,2132,2133,2134,2135,2136,2137,2138,2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2156,2157,2158,8480,8481,8482,8483,8484,8485,8486,8487,8488,8489,8490,8491,8492,8493,8494,8495,8496,8497,8498,8499,8500,8501,8502,8503,8504,8505,8506,8507,8508,8509,8510,8511,8512,8513,8514,8515,8516,8517,8518,8519,8520,8521,8522,8523,8524,8525,8526,8527,8528,8529,8530,8531,8532,8533,8534,8535,8536,8537,8538,8539,8540,8541,8542,8543,8544,8545,8546,8547,8548,8549,8550,8551,8552,8553,8554,8555,8556,8557,8558,8559,8560,8561,8562,8563,8564,8565,8566,8567,8568,8569,8570,8571,8572,8573,8574,171,172,173,8168,9326,9417,7348,8069,8070,8215,8216,8958,9327,9418,9419,9420,7349,7350,7351,7352,8071,8072,8073,8074,8075,8076,8077,8078,8169,8170,8171,8172,8173,8174,8175,8176,8959,8960,8961,8962,9328,9329,9330,9331,9332,9333,9421,9422,9423,9424,9425,9426,9427,9428,9429,9430,9431,7353,7354,7355,7356,7357,7358,7359,7360,7361,7362,7363,7364,7365,7366,7367,7368,7369,7370,7371,7372,8079,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8102,8103,8104,8105,8106,8107,8108,8147,8148,8149,8150,8151,8152,8153,8154,8155,8156,8157,8158,8160,8161,8162,8163,8164,8165,8177,8178,8179,8180,8181,8182,8183,8184,8185,8186,8187,8188,8189,8190,8191,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8208,8209,8210,8211,8212,8213,8214,8217,8218,8219,8220,8221,8222,8223,8224,8225,8226,8227,8228,8229,8230,8231,8232,8233,8234,8235,8236,8237,8238,8239,8240,8241,8242,8243,8244,8245,8246,8247,8248,8249,8250,8251,8252,8253,8254,8255,8256,8257,8258,8259,8260,8261,8262,8263,8264,8265,8266,8267,8268,8269,8270,8271,8272,8273,8274,8275,8276,8277,8278,8279,8280,8281,8282,8283,8284,8285,8286,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,8304,8305,8306,8307,8308,8309,8310,8311,8312,8313,8314,8315,8316,8317,8318,8963,8964,8965,8966,8967,8968,8969,8970,8971,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,9434,9435,9436,9437,9438,9439,9440,9441,9442,9443,9444,9445,9446,9447,9448,9449,9450,9451,9452,9453,9454,9455,9456,9457,9458,9459,9460,9461,9462,9463,9464,9465,9466,9467,9468,9469,9470,9471,9472
        ];

        $pdo_type = $this->argument('pdo');
        $pdo = $this->getPdo($pdo_type);
        $word_label_map = [];

        $export_data =  [];


        $this->output->progressStart(ceil(count($label_ids)/10));
        foreach (array_chunk($label_ids, 10) as $label_chunk){

            // 获得 label_overview 数据
            $label_str = str_repeat("?,", count($label_chunk)-1) . "?";;
            // 获得所有单词的例句解释
            $sql = 'select  `label_id`,`content` from `wordbank_label_overview` where `label_id` in ('.$label_str.')';
            $res  = $pdo->prepare($sql);
            $res->execute($label_chunk);
            $word_label_list = $res->fetchAll(\PDO::FETCH_ASSOC  );

            if (empty($word_label_list)){
                continue;
            }

            foreach ($word_label_list as $item){
                $label_id = $item['label_id'];
                $word_str = $item['content'];

                $word_arr = explode(',', $word_str);

                foreach ($word_arr as $word){
                    if (isset($word_label_map[$word])){
                        $word_label_map[$word][] = $label_id;
                    }else{
                        $word_label_map[$word] = [] ;
                        $word_label_map[$word][] = $label_id;
                    }
                }
            }
            $this->output->progressAdvance();
        }
        $this->output->progressFinish();
        ksort($word_label_map);
        $this->info('单词标签关系获取完毕');

        $this->output->progressStart(ceil(count($word_label_map)/10));
        foreach (array_chunk($word_label_map, 10,TRUE) as $word_label_map_chunk){


            $word_ids = array_keys($word_label_map_chunk);
            $words_str = str_repeat("?,", count($word_ids)-1) . "?";
            \DB::enableQueryLog();

            // 获得所有单词的例句解释
            $sql = 'select  `wordbank`.`id` wordbank_id,`vocabulary`,`wordbank_translation`.`id` translation_id,`translation` , `wordbank_sentence`.`id` sentence_id,`sentence`, `explain` from `wordbank`  left  JOIN  `wordbank_translation` ON `wordbank`.`id` = `wordbank_translation`.`wordbank_id` left  JOIN  `wordbank_sentence` ON `wordbank`.`id` = `wordbank_sentence`.`wordbank_id` where `wordbank`.`id` in ('.$words_str.') and `wordbank`.`deleted_at` is null  and `wordbank_sentence`.`deleted_at` is null  and `wordbank_translation`.`deleted_at` is null';
            $res  = $pdo->prepare($sql);
            $res->execute($word_ids);
            $word_info_list = $res->fetchAll(\PDO::FETCH_ASSOC  );

            foreach ($word_info_list as $word_info_item){
                $tmp = [];
                $tmp = $word_info_item;
                $word_id = $word_info_item['wordbank_id'];
                $local = 0;
                if (in_array($word_id,$word_single)){
                    $local = 1;
                }
                if (in_array($word_id,$word_mess)){
                    $local = 2;
                }
                if (in_array($word_id,$word_300)){
                    $local = 3;
                }
                $label_arr = $word_label_map_chunk[$word_id];
                $label_arr = array_unique($label_arr);
                $label_str = implode(',', $label_arr);
                $tmp['label_ids'] = $label_str;
                $tmp['before'] = $local;

                $export_data[] = $tmp;
            }


            $this->output->progressAdvance();
        }
        $this->output->progressFinish();



        // 保存到文件
        $this->store('单词例句解释_新'.rand(0,100), $export_data, '.xlsx');

        dd($export_data);

        $path = '/home/vagrant/code/sql_analyze/storage/imports';
        $this->traverse($path);

        $this->output->progressStart(count($this->filePath));

        $pdo_type = $this->argument('pdo');
        $pdo = $this->getPdo($pdo_type);

        $save_data = [];
        foreach ($this->filePath as  $file) {
            if (strpos($file, '.gitignore') || strpos($file, 'abc')) {
                $this->output->progressAdvance();
                continue;
            }
            \Log::info($file);
            $contents = $this->import($file);
            $header = array_shift($contents);
            $header = array_filter($header);
            $key_tran = array_flip($header);
            ###检查文件####
            #$save_count = 0;
            #$empty_count = 0;
            ##############
            foreach ($contents as $content) {
                ###检查文件####
//                if(empty($content[$key_tran['单词']])&& empty($content[$key_tran['词性1']])
//                    && empty($content[$key_tran['解释1']]) && empty($content[$key_tran['最小标签的ID']])){
//                    $empty_count++;
//                    if ($save_count<3&&$empty_count>5){
//                        \Log::info($file);
//                        break;
//                    }
//                    continue;
//                }
//                $save_count++;
                ##############

                if(empty($content[$key_tran['单词']])&& empty($content[$key_tran['词性1']])
                    && empty($content[$key_tran['解释1']]) && empty($content[$key_tran['最小标签的ID']])){
                    continue;
                }
                $word = trim($content[$key_tran['单词']]);
                $speed_1 = $this->handleSpeed($content[$key_tran['词性1']]);
                $trans_1 = $this->handleTranslation($content[$key_tran['解释1']]);
                $label_id = trim($content[$key_tran['最小标签的ID']]);


                if (!isset($save_data[$word])){
                    $save_data[$word] = [];
                }
                if (!isset($save_data[$word][$speed_1])){
                    $save_data[$word][$speed_1] = [];
                }
                if (!isset($save_data[$word][$speed_1][$trans_1])){
                    $this->handleTrans($save_data[$word][$speed_1], $trans_1);
//                    $save_data[$word][$speed_1][$trans_1] = [];
                }
                $save_data[$word][$speed_1][$trans_1][] = $label_id;


                if (isset($key_tran['词性2'])&&isset($key_tran['解释2'])&&!empty($content[$key_tran['词性2']]) && empty($content[$key_tran['解释2']])){
                    $speed_2 = $this->handleSpeed($content[$key_tran['词性2']]);
                    $trans_2 = $this->handleTranslation($content[$key_tran['解释2']]);

                    if (!isset($save_data[$word][$speed_2])){
                        $save_data[$word][$speed_2] = [];
                    }
                    if (!isset($save_data[$word][$speed_2][$trans_2])){
                        $this->handleTrans($save_data[$word][$speed_2], $trans_2);
//                        $save_data[$word][$speed_2][$trans_2] = [];
                    }
                    $save_data[$word][$speed_2][$trans_2][] = $label_id;

                }
            }
            $this->output->progressAdvance();
        }


        // 获取 库里的 数据
        $vocabulary = array_keys($save_data);
        $words_str = str_repeat("?,", count($vocabulary)-1) . "?";;
        // 获得所有单词的例句解释
        $sql = 'select  `vocabulary`,`wordbank_id`,`sentence` , `explain` from `wordbank_sentence` 
                INNER  JOIN  `wordbank` ON `wordbank`.`id` = `wordbank_sentence`.`wordbank_id`
                where `vocabulary` in ('.$words_str.') and `wordbank_sentence`.`deleted_at` is null 
                and `wordbank`.`deleted_at` is null';
        $res  = $pdo->prepare($sql);
        $res->execute($vocabulary);
        $word_sentence_list = $res->fetchAll(\PDO::FETCH_ASSOC  );
        $word_sentence_list = collect($word_sentence_list)->keyBy('vocabulary')->toArray();

        // 获取所有的单词
        $sql = 'select  `vocabulary`,`id` from `wordbank` where `vocabulary` in ('.$words_str.') and `wordbank`.`deleted_at` is null';
        $res  = $pdo->prepare($sql);
        $res->execute($vocabulary);
        $word_list = $res->fetchAll(\PDO::FETCH_ASSOC  );
        $word_list = collect($word_list)->pluck('id','vocabulary')->toArray();

        // 拼接数据
        $export_data = [];
        $export_data[] = ['vocabulary', 'part_of_speech', 'translation',  'sentence', 'explain', 'word_id','label_ids'];
        foreach ($save_data as $word=>$speeds){
            $is_first = true;
            $had_word =     isset($word_list[$word])? 1 : 0;
            $had_sentence = isset($word_sentence_list[$word])? 1 : 0;
            foreach ($speeds as $speed=>$trans){
                foreach ($trans as $tran=>$labels){
                    if (!$had_word){
                        $export_data[] = [
                            $word,
                            $speed,
                            $tran,
                            '',
                            '',
                            '单词未录入',
                            implode(',', $labels)
                        ];
                        continue;
                    }
                    if (!$had_sentence){
                        $export_data[] = [
                            $word,
                            $speed,
                            $tran,
                            '单词未上传例句',
                            '单词未上传例句',
                            $word_list[$word],
                            implode(',', $labels)
                        ];
                        continue;
                    }
                    if ($is_first){
                        $export_data[] = [
                            $word,
                            $speed,
                            $tran,
                            $word_sentence_list[$word]['sentence'],
                            $word_sentence_list[$word]['explain'],
                            $word_list[$word],
                            implode(',', $labels)
                        ];
                        $is_first = false;
                    }else{
                        $export_data[] = [
                            $word,
                            $speed,
                            $tran,
                            '',
                            '',
                            $word_list[$word],
                            implode(',', $labels)
                        ];
                    }
                }
            }
        }

        // 保存到文件
        $this->store('单词例句解释'.rand(0,100), $export_data, '.xlsx');
        $this->output->progressFinish();
    }

    // 处理词性
    public function handleSpeed($speed)
    {
        $speed = str_replace(chr(194).chr(160), ' ',$speed);
        $speed = trim($speed);
        if (strpos($speed, '.')===false){
            $speed = $speed.'.';
        }
        return $speed;
    }

    // 处理解释
    public function handleTranslation($translation)
    {
        $translation = trim($translation);
        
        $trans1 = [
            ";"     => "；",
            "，"    => "；",
            ","     => "；",
            "："     => "；",

            "..."   => "......",
            "……"    => "......",
            "⋯⋯"    => "......",


            "("    => "（",
            ")"    => "）",



            "0"     => '零',
            "—"     => "一",
            "1"     => "一",
            "2"     => "二",
            "3"     => "三",
            "4"     => "四",
            "5"     => "五",
            "6"     => "六",
            "7"     => "七",
            "8"     => "八",
            "9"     => "九",
            "10"     => "十",
            "11"     => "十一",
            "12"     => "十二",
            "13"     => "十三",
            "14"     => "十四",
            "15"     => "十五",
            "16"     => "十六",
            "17"     => "十七",
            "18"     => "十八",
            "19"     => "十九",
            "20"     => "二十",
            "21"     => "二十一",
            "30"     => "三十",
            "40"     => "四十",
            "50"     => "五十",
            "60"     => "六十",
            "70"     => "七十",
            "80"     => "八十",
            "90"     => "九十",
            "100"    => "一百",

            '周一'		=> '星期一',
            '周二'		=> '星期二',
            '周三'		=> '星期三',
            '周四'		=> '星期四',
            '周五'		=> '星期五',
            '周六'		=> '星期六',
            '星期天'		=> '星期日',
            '周日'		=> '星期日',

        ];


        $translation = strtr($translation, $trans1);
        
        return $translation;
    }

    // 处理解释
    public function handleTrans(&$list, &$item)
    {
        if (count($list)){
            $is_did = false;
            // 已存在
            $trans_list = array_keys($list);
            foreach ($trans_list as $old_tran){
                $old_tran_list = explode('；', $old_tran);
                $item_list = explode('；', $item);
                if (count($old_tran_list) > 1 && count($item_list) > 1){
                    // 两个相等
                    if (count($old_tran_list) == count(array_intersect($old_tran_list, $item_list))){
                        $item = $old_tran;
                        $is_did = true;
                        break;
                    }
                    // old 大
                    if (count(array_diff($old_tran_list,$item_list)) && !count(array_diff($item_list,$old_tran_list))){
                        $item = $old_tran;
                        $is_did = true;
                        break;
                    }

                    // item 大
                    if (!count(array_diff($old_tran_list,$item_list)) && count(array_diff($item_list,$old_tran_list))){
                        $tmp = $list[$old_tran];
                        $list[$item] = $tmp;
                        unset($list[$old_tran]);

                        $is_did = true;
                        break;
                    }

                    // 互不覆盖
                }


                if (count($old_tran_list) == 1  && count($item_list) > 1){
                    if (in_array($old_tran, $item_list)){
                        if (!isset($list[$item])){
                            $list[$item] = [];
                        }
                        $list[$item] = array_merge($list[$item], $list[$old_tran]);
                        unset($list[$old_tran]);
                    }
                    $is_did = true;
                    continue;
                }

                if (count($old_tran_list) > 1 && count($item_list) == 1){
                    if (in_array($item, $old_tran_list)){
                        $item = $old_tran;
                        $is_did = true;
                        break;
                    }
                }

                if (count($old_tran_list) == 1 && count($item_list) == 1){
                    if($old_tran == $item){
                        $is_did = true;
                        break;
                    }
                }
            }

            if (!$is_did){
                $list[$item] = [];
            }
        }else{
            $list[$item] = [];
        }
    }




    function request($url,$https=true,$method='get',$data=null,$header=[]) {
        $ch = curl_init($url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        if ($https == true){
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER,false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST,false);
        }
        if ($method == 'post'){
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
        }
        if (count($header)){
            curl_setopt($ch, CURLOPT_HTTPHEADER,$header);
        }
        $ret = curl_exec($ch);
        if (curl_errno($ch)) {
            return curl_error($ch);
        }
        curl_close($ch);
        return $ret;
    }

}
